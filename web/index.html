<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpha Protocol | Social Arb Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>

<body>
    <h1>ALPHA PROTOCOL // <span style="font-weight: 400; color: #666;">SOCIAL ARB</span></h1>

    <div class="dashboard" id="app">
        <!-- Cards will be injected here -->
        <div style="color: #666; text-align: center; width: 100%;">Loading Intelligence Ledger...</div>
    </div>

    <script>
        async function loadData() {
            try {
                // Fetch data.json which is generated by the engine
                const response = await fetch('data.json');
                if (!response.ok) throw new Error("Failed to load data");

                const data = await response.json();
                renderDashboard(data);
            } catch (e) {
                console.error(e);
                document.getElementById('app').innerHTML = `<div style="color: red;">Error loading data: ${e.message}. Ensure data.json exists.</div>`;
            }
        }

        function renderDashboard(data) {
            const container = document.getElementById('app');
            container.innerHTML = '';

            if (data.length === 0) {
                container.innerHTML = '<div>No signals detected.</div>';
                return;
            }

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';

                const isBlindSpot = item.blind_spot;
                const badgeClass = isBlindSpot ? 'badge-blindspot' : 'badge-parity';
                const badgeText = isBlindSpot ? 'BLIND SPOT DETECTED' : 'PARITY REACHED';

                // Velocity Arrow
                let velSign = "";
                let velColor = "#666";
                if (item.velocity > 0) { velSign = "▲"; velColor = "#00ff88"; }
                if (item.velocity < 0) { velSign = "▼"; velColor = "red"; }

                let analystInfo = `<div style="font-size:0.7em; margin-top:5px; color:#888;">Analyst Check: ${item.analyst_rating || "N/A"}</div>`;

                card.innerHTML = `
                    <div class="scan-line"></div>
                    <div class="card-header">
                        <span class="ticker">$${item.ticker}</span>
                        <div style="display:flex; gap:5px; align-items:center;">
                            ${item.velocity !== undefined ? `<span class="badge" style="background:${velColor}33; color:${velColor}">${velSign} ${item.velocity} Vel</span>` : ''}
                            <span class="badge ${badgeClass}">${badgeText}</span>
                        </div>
                    </div>
                    <div class="metric">
                        <span>Signal Strength</span>
                        <span class="metric-value">${item.signal_strength}</span>
                    </div>
                    <div class="metric">
                        <span>Sentiment</span>
                        <span class="metric-value">${item.avg_sentiment.toFixed(2)}</span>
                    </div>
                    ${analystInfo}
                    <div class="metric">
                        <span>Rec. Position</span>
                        <span class="metric-value">${item.est_position_shares} Shares</span>
                    </div>
                    <div class="sources">
                        Sources: ${item.sources.join(', ')}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        loadData();
    </script>
</body>

</html>